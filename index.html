<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SkorChat Pro | Eliav Skornick</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Assistant:wght@400;700;800&display=swap');
        
        :root { --skor-green: #3b8e66; }

        body, html {
            margin: 0; padding: 0; height: 100dvh; width: 100%;
            background-color: #000; color: #fff;
            font-family: 'Assistant', sans-serif;
            overflow: hidden; position: fixed; direction: rtl;
        }

        .app-frame { display: flex; flex-direction: column; height: 100dvh; width: 100%; }
        .chat-viewport { 
            flex: 1; overflow-y: auto; padding: 1rem; 
            display: flex; flex-direction: column; gap: 1.5rem;
            unicode-bidi: plaintext; /* שומר על סדר מילים תקין בעברית */
        }

        .user-bubble {
            background-color: var(--skor-green);
            color: white; border-radius: 18px 18px 4px 18px;
            padding: 12px 16px; text-align: right;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .bot-bubble {
            background-color: #1a1a1c;
            color: #efefef; border-radius: 18px 18px 18px 4px;
            padding: 12px 16px; text-align: right;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
            white-space: pre-wrap; /* שומר על ירידות שורה מה-API */
        }

        .send-btn-circle {
            background-color: var(--skor-green);
            width: 50px; height: 50px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            flex-shrink: 0; transition: transform 0.2s;
        }

        .input-box {
            background-color: rgba(22, 22, 24, 0.9);
            border: 1px solid #27272a; border-radius: 20px;
            padding: 8px; display: flex; align-items: center; gap: 10px;
        }

        .thinking-text {
            color: #3b8e66; font-size: 11px; font-weight: 900;
            animation: pulse 1.5s infinite; text-align: center;
        }

        @keyframes pulse { 0%, 100% { opacity: 0.5; } 50% { opacity: 1; } }
    </style>
</head>
<body>

    <div class="app-frame">
        <header class="p-4 flex items-center justify-between border-b border-zinc-900 bg-black/50 backdrop-blur-md">
            <div class="flex items-center gap-2">
                <div class="w-2 h-2 bg-emerald-500 rounded-full animate-pulse"></div>
                <span class="text-[10px] text-zinc-500 font-bold uppercase tracking-widest">CLOUD CONNECTED</span>
            </div>
            <div class="text-right">
                <h1 class="text-lg font-extrabold italic">SkorChat <span class="text-emerald-500 not-italic">Pro</span></h1>
                <p class="text-[9px] text-zinc-600 font-bold uppercase">ELIAV SKORNICK EDITION</p>
            </div>
        </header>

        <main id="chat-viewport" class="chat-viewport"></main>

        <div id="thinking-indicator" class="hidden h-8 flex justify-center items-center">
            <div class="thinking-text uppercase tracking-widest">Skor Intelligence מעבד נתונים...</div>
        </div>

        <div class="p-4 pb-8 bg-black border-t border-zinc-900">
            <div class="max-w-4xl mx-auto">
                <div class="input-box">
                    <button id="main-send" class="send-btn-circle active:scale-90">
                        <i data-lucide="send" class="w-5 h-5"></i>
                    </button>

                    <input id="main-input" type="text" 
                        placeholder="שאל את SkorChat Pro..." 
                        class="flex-1 bg-transparent border-none text-[15px] text-right py-2 px-2 text-white focus:ring-0"
                        dir="rtl">

                    <button id="image-toggle" class="p-3 rounded-xl bg-zinc-800/50 text-zinc-500">
                        <i data-lucide="image" class="w-6 h-6"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const apiKey = "AIzaSyDrdx3NX6XNr_w3kpjpI6WSGNA3elXWAMo"; 
        let isImageMode = false;
        let isBusy = false;

        const chatViewport = document.getElementById('chat-viewport');
        const mainInput = document.getElementById('main-input');
        const mainSend = document.getElementById('main-send');
        const imageToggle = document.getElementById('image-toggle');
        const thinkingIndicator = document.getElementById('thinking-indicator');

        lucide.createIcons();

        imageToggle.addEventListener('click', () => {
            isImageMode = !isImageMode;
            imageToggle.classList.toggle('text-emerald-500', isImageMode);
            mainInput.placeholder = isImageMode ? "תאר את התמונה שברצונך ליצור..." : "שאל את SkorChat Pro...";
        });

        function pushMsg(content, role, imageUrl = null) {
            const container = document.createElement('div');
            container.className = `flex ${role === 'user' ? 'justify-end' : 'justify-start'}`;
            
            if (role === 'user') {
                container.innerHTML = `
                    <div class="flex gap-3 max-w-[85%] flex-row-reverse">
                        <div class="user-bubble" dir="rtl">${content}</div>
                    </div>`;
            } else {
                let html = `
                    <div class="flex gap-3 max-w-[85%]">
                        <div class="bot-bubble" dir="rtl">${content}`;
                if (imageUrl) {
                    html += `<img src="${imageUrl}" class="mt-3 rounded-lg w-full border border-zinc-700" />`;
                }
                html += `</div></div>`;
                container.innerHTML = html;
            }
            
            chatViewport.appendChild(container);
            chatViewport.scrollTo({ top: chatViewport.scrollHeight, behavior: 'smooth' });
        }

        async function handleInteraction() {
            const query = mainInput.value.trim();
            if (!query || isBusy) return;

            pushMsg(query, 'user');
            mainInput.value = '';
            isBusy = true;
            thinkingIndicator.classList.remove('hidden');

            try {
                if (isImageMode) {
                    // כאן תבוא לוגיקת Imagen בעתיד
                    pushMsg("אליאב המייסד, יצירת תמונות דורשת הגדרות ענן מתקדמות. כרגע אני במוד טקסט חכם.", 'bot');
                } else {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: query }] }],
                            systemInstruction: { parts: [{ text: "שמך SkorChat Pro. המייסד הוא אליאב סקורניק. ענה בעברית רהוטה ומכובדת עם אימוג'ים." }] }
                        })
                    });
                    const data = await response.json();
                    const reply = data.candidates?.[0]?.content?.parts?.[0]?.text || "שגיאה בקבלת נתונים.";
                    pushMsg(reply, 'bot');
                }
            } catch (err) {
                pushMsg("שגיאה בחיבור לשרת.", 'bot');
            } finally {
                isBusy = false;
                thinkingIndicator.classList.add('hidden');
            }
        }

        mainInput.addEventListener('keydown', (e) => e.key === 'Enter' && handleInteraction());
        mainSend.addEventListener('click', handleInteraction);
    </script>
</body>
</html>
