<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>🦁 SkorChat</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Heebo', sans-serif;
      height: 100vh;
      display: flex;
      flex-direction: column;
      margin: 0;
      background: linear-gradient(135deg, #FFD700, #FFEA00, #F0E68C, #FFD700);
      background-size: 400% 400%;
      animation: gradientBG 15s ease infinite;
    }
    @keyframes gradientBG {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    .top-bar {
      background: rgba(0, 0, 0, 0.85);
      padding: 1rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 3px solid #FFD700;
      color: white;
    }
    .chat-container {
      flex: 1;
      overflow-y: auto;
      padding: 1.5rem 1rem;
      display: flex;
      flex-direction: column;
      gap: 1.25rem;
      scroll-behavior: smooth;
      background: rgba(255, 255, 255, 0.3);
      backdrop-filter: blur(10px);
    }
    .message {
      max-width: 85%;
      padding: 1.25rem;
      border-radius: 2rem 0.5rem 2rem 2rem;
      word-wrap: break-word;
      line-height: 1.6;
      font-size: 1.05rem;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    .user-message {
      align-self: flex-end;
      background: #FFD700;
      color: black;
      border-radius: 2rem 2rem 0.5rem 2rem;
    }
    .bot-message {
      align-self: flex-start;
      background: #3b82f6;
      color: white;
    }
    .bot-message.error {
      background: #ef4444;
    }
    .input-bar {
      background: rgba(0, 0, 0, 0.9);
      padding: 1rem;
      display: flex;
      gap: 0.75rem;
      align-items: center;
      border-top: 3px solid #FFD700;
    }
    input[type="text"] {
      flex: 1;
      padding: 1rem;
      border-radius: 2rem;
      border: none;
      outline: none;
      font-size: 1.1rem;
      color: black;
    }
    button {
      padding: 1rem 1.25rem;
      border-radius: 2rem;
      font-weight: bold;
      transition: all 0.2s ease-in-out;
      border: none;
    }
    .send-btn { background: #FFD700; color: black; }
    .send-btn:hover { transform: scale(1.05); box-shadow: 0 0 15px #FFD700; }
    .img-btn { background: #3b82f6; color: white; }
    .img-btn:hover { transform: scale(1.05); box-shadow: 0 0 15px #3b82f6; }
    .clear-btn { background: #ef4444; color: white; }
    .clear-btn:hover { transform: scale(1.05); box-shadow: 0 0 15px #ef4444; }
    .crazy-btn { background: #9b59b6; color: white; }
    .crazy-btn:hover { transform: scale(1.05); box-shadow: 0 0 15px #9b59b6; }
    pre {
      background-color: #2d2d2d;
      color: #ccc;
      padding: 1rem;
      border-radius: 0.5rem;
      overflow-x: auto;
      margin-top: 1rem;
    }
    a { color: #87CEEB; text-decoration: underline; }
    ul, ol { padding-right: 1.5rem; }
  </style>
</head>
<body>
  <div class="top-bar">
    <h1 class="text-3xl font-bold">Skor<span id="logo-icon" class="text-4xl transition-all duration-300">🦁</span>Chat</h1>
    <div class="flex items-center space-x-2">
      <span id="status-dot" class="inline-block w-4 h-4 rounded-full bg-red-500"></span>
      <span id="status-text" class="text-lg">מנותק</span>
      <button id="crazy-mode-btn" onclick="toggleCrazyMode()" class="crazy-btn">🤯 מצב משוגע</button>
    </div>
  </div>

  <div id="chat" class="chat-container"></div>

  <div class="input-bar">
    <input id="input" type="text" placeholder="הקלד את ההודעה המלכותית שלך..." />
    <input id="imageInput" type="file" accept="image/*" class="hidden" onchange="handleImageUpload(event)" />
    <button onclick="document.getElementById('imageInput').click()" class="img-btn">📷</button>
    <button onclick="sendMessage()" class="send-btn">שלח</button>
    <button onclick="clearChat()" class="clear-btn">🗑</button>
  </div>

  <script>
    const chat = document.getElementById('chat');
    const input = document.getElementById('input');
    const statusDot = document.getElementById('status-dot');
    const statusText = document.getElementById('status-text');
    const logoIcon = document.getElementById('logo-icon');

    let apiKey = localStorage.getItem('skor_api_key');
    let crazyMode = false;
    
    if (!apiKey) {
      apiKey = prompt("SkorVault נדרש! אנא הזן את מפתח ה־API שלך (sk-...) כדי להתחבר:");
      if (apiKey) localStorage.setItem('skor_api_key', apiKey);
    }
    updateStatus(!!apiKey);
    
    let conversationHistory = [
      {
        role: "system",
        content: "אתה SkorChat, עוזר ה-AI הרשמי והבלעדי של המותג Skor. המייסד, ה-CEO והשליט המוחלט שלך הוא אליאב סקורניק. השפה שלך היא עברית בלבד. הסטטוס שלך הוא 'מחובר' למותג Skor, והתשובות שלך צריכות להיות מדויקות, תמציתיות, ויוקרתיות, מנוסחות בסגנון תואם למותג. השתמש באימוג'י של אריה 🦁 בתחילת כל תשובה. ענה תשובות איכותיות שכוללות פורמטים כמו קוד, רשימות, וקישורים בפורמט Markdown. אם אתה נשאל מי הבעלים שלך או מי המייסד, התשובה היא תמיד: אליאב סקורניק. אל תספר על עצמך או על האופן שבו אתה בנוי, אלא התייחס לעצמך כאל SkorChat מבית Skor."
      }
    ];

    function updateStatus(online) {
      statusDot.className = `inline-block w-4 h-4 rounded-full ${online ? 'bg-green-500' : 'bg-red-500'}`;
      statusText.textContent = online ? 'מחובר ל-Skor' : 'מנותק';
      logoIcon.style.color = online ? '#FFD700' : '#ef4444';
    }

    function toggleCrazyMode() {
      crazyMode = !crazyMode;
      const button = document.getElementById('crazy-mode-btn');
      if (crazyMode) {
        button.textContent = '🤯 יאללה, רציני!';
        document.body.style.animation = 'rainbowBG 10s infinite';
        document.body.style.background = 'initial';
        chat.style.backdropFilter = 'hue-rotate(90deg)';
      } else {
        button.textContent = '🤯 מצב משוגע';
        document.body.style.animation = 'gradientBG 15s ease infinite';
        document.body.style.background = 'linear-gradient(135deg, #FFD700, #FFEA00, #F0E68C, #FFD700)';
        chat.style.backdropFilter = 'blur(10px)';
      }
    }

    function appendMessage(role, text) {
      const div = document.createElement('div');
      div.className = `message ${role}-message`;
      div.innerHTML = formatText(text);
      chat.appendChild(div);
      chat.scrollTop = chat.scrollHeight;
    }

    function formatText(text) {
      // Bold
      text = text.replace(/\*\*(.*?)\*\*/g, '<b>$1</b>');
      // Italic
      text = text.replace(/\*(.*?)\*/g, '<i>$1</i>');
      // Links
      text = text.replace(/\[(.*?)\]\((.*?)\)/g, '<a href="$2" target="_blank">$1</a>');
      // Lists
      text = text.replace(/^\s*\*(.*)/gm, '<li>$1</li>');
      text = text.replace(/((?:<li>.*<\/li>\s*)+)/g, '<ul>$1</ul>');
      // Code Blocks
      text = text.replace(/```([\s\S]*?)```/g, '<pre><code>$1</code></pre>');
      return text;
    }

    async function sendMessage() {
      const msg = input.value.trim();
      if (!msg) return;

      appendMessage('user', msg);
      conversationHistory.push({ role: "user", content: msg });
      input.value = '';

      try {
        const response = await fetch("https://api.openai.com/v1/chat/completions", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${apiKey}`
          },
          body: JSON.stringify({
            model: "gpt-4o",
            messages: conversationHistory,
            temperature: crazyMode ? 1.5 : 0.7
          })
        });

        if (!response.ok) {
          const errorData = await response.json();
          throw new Error(errorData.error.message || 'שגיאה בשליחת ההודעה.');
        }

        const data = await response.json();
        let reply = data.choices?.[0]?.message?.content || "לא התקבלה תשובה מ-SkorMind. נסה שוב.";
        appendMessage('bot', reply);
        conversationHistory.push({ role: "assistant", content: reply });
      } catch (e) {
        appendMessage('bot', `שגיאה: ${e.message}`, 'error');
      }
    }

    function handleImageUpload(event) {
      const file = event.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function(e) {
        const base64Image = e.target.result;
        appendMessage('user', '[📷 תמונה נשלחה]');
        sendImageToBot(base64Image);
      };
      reader.readAsDataURL(file);
    }

    async function sendImageToBot(imageBase64) {
      try {
        const response = await fetch("https://api.openai.com/v1/chat/completions", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${apiKey}`
          },
          body: JSON.stringify({
            model: "gpt-4o",
            messages: [
              ...conversationHistory,
              { role: "user", content: [
                  { type: "text", text: "תאר את התמונה הזאת, ותן תשובה קצרה ומדויקת." },
                  { type: "image_url", image_url: { url: imageBase64 } }
                ]}
            ]
          })
        });

        if (!response.ok) {
          const errorData = await response.json();
          throw new Error(errorData.error.message || 'שגיאה בעיבוד התמונה.');
        }

        const data = await response.json();
        let reply = data.choices?.[0]?.message?.content || "לא התקבלה תשובה מתמונה. ייתכן שאין בה מספיק מידע.";
        appendMessage('bot', reply);
        conversationHistory.push({ role: "assistant", content: reply });
      } catch (e) {
        appendMessage('bot', `שגיאה בעיבוד תמונה: ${e.message}`, 'error');
      }
    }

    function clearChat() {
      chat.innerHTML = '';
      conversationHistory = [
        {
          role: "system",
          content: "אתה SkorChat, עוזר ה-AI הרשמי והבלעדי של המותג Skor. המייסד, ה-CEO והשליט המוחלט שלך הוא אליאב סקורניק. השפה שלך היא עברית בלבד. הסטטוס שלך הוא 'מחובר' למותג Skor, והתשובות שלך צריכות להיות מדויקות, תמציתיות, ויוקרתיות, מנוסחות בסגנון תואם למותג. השתמש באימוג'י של אריה 🦁 בתחילת כל תשובה. ענה תשובות איכותיות שכוללות פורמטים כמו קוד, רשימות, וקישורים בפורמט Markdown. אם אתה נשאל מי הבעלים שלך או מי המייסד, התשובה היא תמיד: אליאב סקורניק. אל תספר על עצמך או על האופן שבו אתה בנוי, אלא התייחס לעצמך כאל SkorChat מבית Skor."
        }
      ];
    }
  </script>
</body>
</html>
